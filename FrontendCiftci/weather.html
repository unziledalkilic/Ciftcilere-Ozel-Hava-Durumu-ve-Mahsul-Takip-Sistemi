<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akƒ±llƒ± Tarƒ±m Asistanƒ±</title>
    <!-- Tailwind CSS CDN kaldƒ±rƒ±ldƒ±, custom CSS kullanƒ±lƒ±yor -->
    <style>
        /* Genel Stil Ayarlarƒ± */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Mor-mavi gradient */
            min-height: 100vh;
            padding: 20px;
            display: flex; /* ƒ∞√ßeriƒüi dikeyde ortalamak i√ßin */
            justify-content: center;
            align-items: flex-start; /* ƒ∞√ßeriƒüi √ºste hizala */
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr; /* Tek s√ºtun varsayƒ±lan */
            gap: 20px;
        }

        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 2fr; /* Tablet ve masa√ºst√ºnde iki s√ºtun */
            }
        }

        /* Ba≈ülƒ±k Stilleri */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            grid-column: 1 / -1; /* T√ºm s√ºtunlarƒ± kapla */
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Kart Stilleri (Form ve Sonu√ßlar) */
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
        }

        /* Form Elemanlarƒ± Stilleri */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            background-color: #f8f9fa; /* Hafif arka plan */
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        /* Buton Stilleri */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%; /* Tam geni≈ülik */
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Sonu√ß Kartƒ± Stilleri */
        .result-card {
            background: #f8f9fa;
            border-left: 4px solid #28a745; /* Ye≈üil kenarlƒ±k */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            display: none; /* Varsayƒ±lan olarak gizli */
        }

        .result-card h2 {
            margin-bottom: 20px;
            color: #333;
        }

        /* Hava Durumu Bilgisi Stili */
        .weather-info {
            background: #e3f2fd; /* A√ßƒ±k mavi */
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #bbdefb;
            color: #1a202c;
        }

        /* √ñneri ve Mahsul Kartlarƒ± Gridi */
        .crop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .crop-card {
            background-color: #ffffff; /* Beyaz */
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .crop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .crop-card h3 {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 10px;
        }

        .crop-score {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            line-height: 1; /* Satƒ±r y√ºksekliƒüini ayarla */
        }

        .crop-details {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #555;
            text-align: left;
            padding: 0 10px;
        }
        .crop-details strong {
            color: #333;
        }

        .advice-section {
            background: #e6ffed; /* A√ßƒ±k ye≈üil */
            border: 1px solid #b2f5ea;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .advice-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        .advice-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .advice-section ul li {
            background: #ffffff;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #4a5568;
        }
        .advice-section ul li::before {
            content: '‚Ä¢';
            color: #38a169;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }


        /* Y√ºkleme ve Hata Mesajƒ± Stilleri */
        .loading, .error-message {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 600;
        }
        
        .loading {
            background-color: #e0f7fa; /* A√ßƒ±k cam g√∂beƒüi */
            color: #00796b;
            display: none; /* Varsayƒ±lan olarak gizli */
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #ffebee; /* A√ßƒ±k kƒ±rmƒ±zƒ± */
            color: #c62828;
            border: 1px solid #ef9a9a;
            display: none; /* Varsayƒ±lan olarak gizli */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåæ Akƒ±llƒ± Tarƒ±m Asistanƒ±</h1>
            <p>Ger√ßek zamanlƒ± hava durumu verileriyle mahsul verimi analizi</p>
        </div>

        <!-- Input Form -->
        <div class="card">
            <h2>Tarƒ±m Analizi Ba≈ülat</h2>
            <div id="error-message" class="error-message"></div>
            
            <div class="form-group">
                <label for="city">≈ûehir:</label>
                <select id="city" required>
                    <!-- ≈ûehirler JS ile doldurulacak -->
                </select>
            </div>

            <div class="form-group">
                <label for="crop">Mahsul:</label>
                <select id="crop" required>
                    <!-- Mahsuller JS ile doldurulacak -->
                </select>
            </div>

            <div class="form-group">
                <label for="soilType">Toprak Tipi:</label>
                <select id="soilType" required>
                    <!-- Toprak tipleri JS ile doldurulacak -->
                </select>
            </div>

            <div class="form-group">
                <label for="areaInput">Alan (D√∂n√ºm):</label>
                <input type="number" id="areaInput" value="10" min="1" required>
            </div>

            <button class="btn" onclick="getRecommendation()">
                Analizi Ba≈ülat
            </button>
        </div>

        <!-- Y√ºkleniyor Durumu -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Veriler y√ºkleniyor ve analiz ediliyor...</p>
        </div>

        <!-- Recommendations Display -->
        <div id="resultCard" class="result-card">
            <h2>üìä Analiz Sonu√ßlarƒ±</h2>
            <div id="results">
                <p>Yukarƒ±daki formu doldurarak analiz ba≈ülatƒ±n ve AI destekli mahsul √∂nerilerini burada g√∂r√ºn.</p>
            </div>
        </div>
    </div>

    <script>
        // OpenWeatherMap API Anahtarƒ±nƒ±z Buraya Girin (Saƒülanan bilgiden g√ºncellendi)
        const OPENWEATHERMAP_API_KEY = 'e4b7070abab1899610fd58316c8d4c53'; 

        // Mahsullerin optimal ko≈üullarƒ± (Python modelindeki sentetik veri olu≈üturma mantƒ±ƒüƒ±na yakƒ±n)
        const cropOptimalConditions = {
            'Buƒüday': { temp: { min: 15, max: 25 }, hum: { min: 40, max: 70 }, rain: 'Orta' },
            'Arpa': { temp: { min: 12, max: 22 }, hum: { min: 35, max: 65 }, rain: 'Orta' },
            'Mƒ±sƒ±r': { temp: { min: 20, max: 30 }, hum: { min: 50, max: 80 }, rain: 'Y√ºksek' },
            'Domates': { temp: { min: 18, max: 28 }, hum: { min: 60, max: 80 }, rain: 'Y√ºksek' },
            'Patlƒ±can': { temp: { min: 22, max: 32 }, hum: { min: 65, max: 85 }, rain: 'Y√ºksek' },
            'Salatalƒ±k': { temp: { min: 18, max: 28 }, hum: { min: 70, max: 90 }, rain: 'Y√ºksek' },
            'Kabak': { temp: { min: 20, max: 30 }, hum: { min: 60, max: 80 }, rain: 'Y√ºksek' },
            'Soƒüan': { temp: { min: 12, max: 25 }, hum: { min: 50, max: 70 }, rain: 'D√º≈ü√ºk-Orta' },
            'Sarƒ±msak': { temp: { min: 10, max: 20 }, hum: { min: 45, max: 65 }, rain: 'D√º≈ü√ºk-Orta' },
            'Havu√ß': { temp: { min: 15, max: 25 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Lahana': { temp: { min: 10, max: 20 }, hum: { min: 70, max: 90 }, rain: 'Y√ºksek' },
            'Marul': { temp: { min: 10, max: 22 }, hum: { min: 65, max: 85 }, rain: 'Orta' },
            'Elma': { temp: { min: 10, max: 25 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Armut': { temp: { min: 12, max: 26 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Kiraz': { temp: { min: 8, max: 22 }, hum: { min: 55, max: 75 }, rain: 'D√º≈ü√ºk' },
            'Vi≈üne': { temp: { min: 8, max: 22 }, hum: { min: 55, max: 75 }, rain: 'D√º≈ü√ºk' },
            '≈ûeftali': { temp: { min: 15, max: 28 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Kayƒ±sƒ±': { temp: { min: 15, max: 30 }, hum: { min: 50, max: 70 }, rain: 'D√º≈ü√ºk' },
            '√úz√ºm': { temp: { min: 15, max: 30 }, hum: { min: 50, max: 70 }, rain: 'D√º≈ü√ºk' },
            'ƒ∞ncir': { temp: { min: 18, max: 32 }, hum: { min: 55, max: 75 }, rain: 'D√º≈ü√ºk' },
            'Nar': { temp: { min: 15, max: 30 }, hum: { min: 50, max: 70 }, rain: 'D√º≈ü√ºk' },
            'Ayva': { temp: { min: 10, max: 25 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Pamuk': { temp: { min: 22, max: 32 }, hum: { min: 45, max: 75 }, rain: 'Orta' },
            'Ay√ßi√ßeƒüi': { temp: { min: 18, max: 28 }, hum: { min: 50, max: 70 }, rain: 'Orta' },
            '≈ûekerpancarƒ±': { temp: { min: 15, max: 25 }, hum: { min: 65, max: 85 }, rain: 'Y√ºksek' },
            'T√ºt√ºn': { temp: { min: 20, max: 30 }, hum: { min: 70, max: 90 }, rain: 'Y√ºksek' },
            'Susam': { temp: { min: 25, max: 35 }, hum: { min: 40, max: 60 }, rain: 'D√º≈ü√ºk' },
            'Zeytin': { temp: { min: 15, max: 25 }, hum: { min: 50, max: 70 }, rain: 'D√º≈ü√ºk-Orta' },
            '√áay': { temp: { min: 18, max: 25 }, hum: { min: 70, max: 90 }, rain: '√áok Y√ºksek' },
            'Fƒ±ndƒ±k': { temp: { min: 13, max: 20 }, hum: { min: 65, max: 85 }, rain: 'Y√ºksek' },
            'Ceviz': { temp: { min: 10, max: 25 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'Badem': { temp: { min: 15, max: 30 }, hum: { min: 45, max: 65 }, rain: 'D√º≈ü√ºk' },
            'Antepfƒ±stƒ±ƒüƒ±': { temp: { min: 18, max: 32 }, hum: { min: 40, max: 60 }, rain: 'D√º≈ü√ºk' },
            'Nohut': { temp: { min: 15, max: 25 }, hum: { min: 45, max: 65 }, rain: 'D√º≈ü√ºk-Orta' },
            'Mercimek': { temp: { min: 12, max: 22 }, hum: { min: 40, max: 60 }, rain: 'D√º≈ü√ºk-Orta' },
            'Fasulye': { temp: { min: 18, max: 28 }, hum: { min: 60, max: 80 }, rain: 'Orta' },
            'B√∂r√ºlce': { temp: { min: 20, max: 30 }, hum: { min: 55, max: 75 }, rain: 'Orta' }
        };


        document.addEventListener('DOMContentLoaded', initApp);

        async function initApp() {
            showLoading(true); // Sayfa y√ºklenirken y√ºkleniyor g√∂ster
            try {
                console.log('Attempting to fetch options from Flask API...'); // Added log
                // Flask API'den se√ßenekleri √ßek
                const response = await fetch('http://localhost:5000/options', { mode: 'cors' });
                console.log('Fetch response received:', response); // Added log
                if (!response.ok) {
                    // HTTP durumu 2xx aralƒ±ƒüƒ±nda deƒüilse hata fƒ±rlat
                    const errorText = await response.text();
                    throw new Error(`API se√ßenekleri y√ºklenemedi: ${response.status} ${response.statusText} - ${errorText}`);
                }
                const data = await response.json();
                console.log('Options data received:', data); // Added log

                populateSelect('city', data.cities); // Yeni HTML'deki 'city' ID'si
                populateSelect('crop', data.crops);   // Yeni HTML'deki 'crop' ID'si
                populateSelect('soilType', data.soil_types); // Yeni HTML'deki 'soilType' ID'si
                
                // Varsayƒ±lan ≈üehri Diyarbakƒ±r olarak ayarla (eƒüer varsa)
                const citySelect = document.getElementById('city');
                if (data.cities.includes('Diyarbakƒ±r')) {
                    citySelect.value = 'Diyarbakƒ±r';
                }

            } catch (error) {
                console.error('Uygulama ba≈ülatƒ±lƒ±rken hata olu≈ütu:', error);
                let errorMessage = 'Uygulama se√ßenekleri y√ºklenemedi. ';
                if (error instanceof TypeError && error.message === 'Failed to fetch') {
                    errorMessage += 'Bu genellikle Flask API sunucusunun √ßalƒ±≈ümƒ±yor veya eri≈üilemiyor olmasƒ±ndan kaynaklanƒ±r. L√ºtfen VS Code terminalinizde `python app.py` komutunu √ßalƒ±≈ütƒ±rdƒ±ƒüƒ±nƒ±zdan ve uygulamanƒ±n hatasƒ±z √ßalƒ±≈ütƒ±ƒüƒ±ndan emin olun.';
                } else {
                    errorMessage += `Hata: ${error.message}.`;
                }
                showError(errorMessage);
            } finally {
                showLoading(false); // Y√ºkleme bitti, gizle
            }
        }

        function populateSelect(selectId, items) {
            const selectElement = document.getElementById(selectId);
            selectElement.innerHTML = ''; // √ñnceki se√ßenekleri temizle
            // ƒ∞lk se√ßenek olarak "Se√ßim yapƒ±n..." ekle
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `${selectId === 'city' ? '≈ûehir' : selectId === 'crop' ? 'Mahsul' : 'Toprak Tipi'} se√ßin...`;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
        }

        async function getRecommendation() { 
            hideError(); 
            showLoading(true); 
            document.getElementById('resultCard').style.display = 'none'; 

            const city = document.getElementById('city').value;
            const crop = document.getElementById('crop').value; 
            const soilType = document.getElementById('soilType').value;
            const area = parseFloat(document.getElementById('areaInput').value);

            if (!city || !crop || !soilType || isNaN(area) || area <= 0) {
                showError('L√ºtfen t√ºm alanlarƒ± doldurun ve ge√ßerli bir alan deƒüeri girin.');
                showLoading(false);
                return;
            }

            try {
                // Adƒ±m 1: Hava durumu verilerini OpenWeatherMap API'sinden √ßek
                console.log('Attempting to fetch weather data for:', city); // Added log
                const weather = await fetchWeatherData(city);
                console.log('Weather data received:', weather); // Added log
                
                // Adƒ±m 2: Flask API'ye tekil tahmin isteƒüi g√∂nder
                console.log('Attempting to fetch prediction from Flask API...'); // Added log
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        city: city,
                        crop: crop, 
                        soil_type: soilType,
                        temperature: weather.temp,
                        humidity: weather.humidity,
                        rainfall: weather.rainfall
                    }),
                    mode: 'cors' 
                });
                console.log('Prediction fetch response received:', response); // Added log
                
                if (!response.ok) {
                    const errorData = await response.json(); 
                    throw new Error(`Model tahmini alƒ±namadƒ±: ${response.status} ${response.statusText} - ${errorData.error || 'Bilinmeyen bir hata olu≈ütu.'}`);
                }

                const data = await response.json();
                console.log('Prediction data received:', data); // Added log
                
                if (data.success) {
                    // Tahmin skoru ve hava durumu bilgilerini kullanarak tavsiyeleri al
                    const adviceList = getTemperatureBasedAdvice(crop, weather.temp, weather.humidity, weather.rainfall);
                    displaySinglePrediction(data.yield_score, crop, area, weather, soilType, city, adviceList);
                } else {
                    showError('Model tahmini alƒ±namadƒ±: ' + (data.error || 'API\'den beklenmeyen bir yanƒ±t geldi.'));
                }
                
            } catch (error) {
                console.error('Analiz hatasƒ±:', error);
                let errorMessage = 'Analiz sƒ±rasƒ±nda bir hata olu≈ütu. ';
                 if (error instanceof TypeError && error.message === 'Failed to fetch') {
                    errorMessage += 'Bu genellikle Flask API sunucusunun √ßalƒ±≈ümƒ±yor veya eri≈üilemiyor olmasƒ±ndan kaynaklanƒ±r. L√ºtfen VS Code terminalinizde `python app.py` komutunu √ßalƒ±≈ütƒ±rdƒ±ƒüƒ±nƒ±zdan ve uygulamanƒ±n hatasƒ±z √ßalƒ±≈ütƒ±ƒüƒ±ndan emin olun.';
                } else {
                    errorMessage += `Hata: ${error.message}. L√ºtfen konsolu kontrol edin.`;
                }
                showError(errorMessage);
            } finally {
                showLoading(false); 
            }
        }

        async function fetchWeatherData(city) {
            // API anahtarƒ±nƒ±n bo≈ü olup olmadƒ±ƒüƒ±nƒ± kontrol et
            if (OPENWEATHERMAP_API_KEY === 'YOUR_OPENWEATHERMAP_API_KEY' || !OPENWEATHERMAP_API_KEY) {
                throw new Error('OpenWeatherMap API anahtarƒ± ayarlanmadƒ±. L√ºtfen `index.html` dosyasƒ±ndaki `OPENWEATHERMAP_API_KEY` deƒüerini kendi anahtarƒ±nƒ±zla g√ºncelleyin.');
            }

            // OpenWeatherMap Current Weather API URL'si
            // Dinamik ≈üehir, metrik birimler ve T√ºrk√ße dil kullanƒ±lƒ±yor.
            const weatherApiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city},TR&units=metric&lang=tr&appid=${OPENWEATHERMAP_API_KEY}`;

            try {
                const response = await fetch(weatherApiUrl);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Hava durumu verisi alƒ±namadƒ±: ${errorData.message || response.statusText}`);
                }
                const data = await response.json();

                const temperature = data.main.temp;
                const humidity = data.main.humidity;
                // OpenWeatherMap API'sinden anlƒ±k yaƒüƒ±≈ü (mm) genellikle 'rain' objesi i√ßinde '1h' veya '3h' olarak gelir.
                // Eƒüer yoksa 0 kabul ediyoruz.
                const rainfall = data.rain ? (data.rain['1h'] || data.rain['3h'] || 0) : 0; 

                return {
                    temp: temperature,
                    humidity: humidity,
                    rainfall: rainfall
                };
            } catch (error) {
                console.error('Hava durumu API hatasƒ±:', error);
                let errorMessage = `Hava durumu verisi alƒ±nƒ±rken bir hata olu≈ütu: ${error.message}. `;
                if (error.message.includes('401')) {
                    errorMessage += 'Muhtemelen OpenWeatherMap API anahtarƒ±nƒ±z ge√ßersiz veya ayarlanmamƒ±≈ü.';
                } else if (error.message.includes('404')) {
                    errorMessage += '≈ûehir bulunamadƒ± veya yazƒ±m yanlƒ±≈üƒ± olabilir.';
                }
                showError(errorMessage + ' Varsayƒ±lan deƒüerler kullanƒ±lƒ±yor.');
                return {
                    temp: 20,    
                    humidity: 60, 
                    rainfall: 45 
                };
            }
        }

        function getTemperatureBasedAdvice(cropName, currentTemp, currentHumidity, currentRainfall) {
            const advice = [];
            const cropInfo = cropOptimalConditions[cropName];

            if (!cropInfo) {
                advice.push(`Genel tarƒ±m tavsiyesi: "${cropName}" mahsul√º i√ßin √∂zel bilgi bulunamadƒ±.`);
                return advice;
            }

            const { temp: optimalTemp, hum: optimalHum, rain: waterNeedCategory } = cropInfo;

            // Sƒ±caklƒ±k bazlƒ± tavsiyeler
            if (currentTemp < optimalTemp.min - 5) {
                advice.push(`üå°Ô∏è Hava √ßok soƒüuk (${currentTemp}¬∞C). Bu sƒ±caklƒ±k "${cropName}" i√ßin uygun deƒüil. Don riskine kar≈üƒ± √∂nlem alƒ±n veya erken ekimden ka√ßƒ±nƒ±n.`);
            } else if (currentTemp < optimalTemp.min) {
                advice.push(`üå°Ô∏è Hava "${cropName}" i√ßin biraz serin (${currentTemp}¬∞C). Bitki geli≈üimini yava≈ülatabilir. Gerekirse serinlik toleransƒ± olan √ße≈üitleri d√º≈ü√ºn√ºn veya koruma saƒülayƒ±n.`);
            } else if (currentTemp > optimalTemp.max + 5) {
                advice.push(`üî• Hava √ßok sƒ±cak (${currentTemp}¬∞C). Bu durum "${cropName}" i√ßin stres yaratabilir. A≈üƒ±rƒ± sƒ±caklara kar≈üƒ± g√∂lgeleme veya sulama sƒ±klƒ±ƒüƒ±nƒ± artƒ±rma gibi √∂nlemler alƒ±n.`);
            } else if (currentTemp > optimalTemp.max) {
                advice.push(`‚òÄÔ∏è Hava "${currentTemp}¬∞C) "${cropName}" i√ßin biraz sƒ±cak. D√ºzenli sulama ve bitkileri stresten koruma √∂nemlidir.`);
            } else {
                advice.push(`‚úÖ Sƒ±caklƒ±k (${currentTemp}¬∞C) "${cropName}" i√ßin ideal aralƒ±kta. Optimum geli≈üim beklenir.`);
            }

            // Nem bazlƒ± tavsiyeler
            if (currentHumidity < optimalHum.min - 10) {
                advice.push(`üíß Nem oranƒ± (${currentHumidity}%) d√º≈ü√ºk. Kuraklƒ±k stresi olu≈üabilir. Sulama sƒ±klƒ±ƒüƒ±nƒ± ve miktarƒ±nƒ± artƒ±rmayƒ± d√º≈ü√ºn√ºn.`);
            } else if (currentHumidity > optimalHum.max + 10) {
                advice.push(`üí¶ Nem oranƒ± (${currentHumidity}%) √ßok y√ºksek. Fungal hastalƒ±k riskine kar≈üƒ± bitkileri g√∂zlemleyin ve iyi havalandƒ±rma saƒülayƒ±n.`);
            } else if (currentHumidity >= optimalHum.min && currentHumidity <= optimalHum.max) {
                 advice.push(`üíß Nem oranƒ± (${currentHumidity}%) "${cropName}" i√ßin uygun seviyelerde.`);
            }

            // Yaƒüƒ±≈ü bazlƒ± tavsiyeler (Bu kƒ±sƒ±m i√ßin OpenWeatherMap'ten anlƒ±k yaƒüƒ±≈ü verisi gelmese bile genel bir mantƒ±k y√ºr√ºt√ºlebilir)
            if (waterNeedCategory === '√áok Y√ºksek' && currentRainfall < 10) { // √ñrn: √áay
                advice.push(`üåßÔ∏è "${cropName}" √ßok y√ºksek su ihtiyacƒ±na sahip. Mevcut yaƒüƒ±≈ü (${currentRainfall}mm) yetersiz. Yoƒüun sulama planlamasƒ± yapƒ±n.`);
            } else if (waterNeedCategory === 'Y√ºksek' && currentRainfall < 5) {
                advice.push(`üåßÔ∏è "${cropName}" y√ºksek su ihtiyacƒ±na sahip. Mevcut yaƒüƒ±≈ü (${currentRainfall}mm) yetersiz. D√ºzenli sulama √∂nemlidir.`);
            } else if (waterNeedCategory === 'D√º≈ü√ºk' && currentRainfall > 30) { // A≈üƒ±rƒ± yaƒüƒ±≈ü
                advice.push(`‚òî "${cropName}" d√º≈ü√ºk su ihtiyacƒ±na sahip. A≈üƒ±rƒ± yaƒüƒ±≈ü (${currentRainfall}mm) k√∂k √ß√ºr√ºmesine yol a√ßabilir. Drenajƒ± kontrol edin.`);
            } else if (currentRainfall > 0) {
                advice.push(`üíß Mevcut yaƒüƒ±≈ü (${currentRainfall}mm) topraƒüƒ±n nem dengesine katkƒ±da bulunuyor. Sulama ihtiyacƒ±nƒ±zƒ± buna g√∂re ayarlayƒ±n.`);
            } else {
                advice.push(`‚òÄÔ∏è Yaƒüƒ±≈ü yok. Toprak nemini kontrol edin ve "${cropName}" i√ßin d√ºzenli sulama yapmayƒ± unutmayƒ±n.`);
            }

            // Genel tavsiyeler (her zaman g√∂sterilebilir veya duruma g√∂re)
            advice.push("üîç Bitkilerinizi d√ºzenli olarak hastalƒ±k ve zararlƒ±lar i√ßin kontrol edin.");
            advice.push("üå± Toprak analizi yaparak besin eksikliklerini belirleyin ve g√ºbreleme yapƒ±n.");

            return advice;
        }

        function displaySinglePrediction(score, crop, area, weather, soilType, city, adviceList) {
            const resultsDiv = document.getElementById('results');
            document.getElementById('resultCard').style.display = 'block'; 
            
            // Skor rengini belirle
            let scoreColor = '#e74c3c'; 
            if (score >= 80) scoreColor = '#27ae60'; 
            else if (score >= 60) scoreColor = '#f39c12'; 
            else if (score >= 40) scoreColor = '#e67e22'; 
            
            // Ekonomik bilgiler (basitle≈ütirilmi≈ü ve √∂rnek deƒüerler)
            const estimatedYieldPerD√∂n√ºm = (score / 100) * 0.5; 
            const estimatedTotalYield = estimatedYieldPerD√∂n√ºm * area; 
            const averagePricePerTon = 8000; 
            const estimatedRevenue = estimatedTotalYield * averagePricePerTon; 
            
            let adviceHtml = adviceList.map(tip => `<li>${tip}</li>`).join('');

            resultsDiv.innerHTML = `
                <div class="weather-info">
                    <h3>üå§Ô∏è ${city} Hava Durumu</h3>
                    <p><strong>Sƒ±caklƒ±k:</strong> ${weather.temp}¬∞C</p>
                    <p><strong>Nem:</strong> ${weather.humidity}%</p>
                    <p><strong>Yaƒüƒ±≈ü:</strong> ${weather.rainfall}mm</p>
                </div>

                <div class="crop-card">
                    <h3>üåæ ${crop}</h3>
                    <div class="crop-score" style="color: ${scoreColor}">
                        ${score.toFixed(1)}/100
                    </div>
                    <div class="crop-details">
                        <strong>Uygunluk:</strong> ${getScoreDescription(score)}<br>
                        <strong>Toprak Tipi:</strong> ${soilType}<br>
                        <strong>Tahmini Verim (${area} D√∂n√ºm):</strong> ${estimatedTotalYield.toFixed(1)} ton<br>
                        <strong>Tahmini Gelir:</strong> ‚Ç∫${estimatedRevenue.toLocaleString('tr-TR', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                    </div>
                </div>

                <div class="advice-section">
                    <h3>üí° G√ºncel Hava Durumuna G√∂re Tarƒ±msal Tavsiyeler:</h3>
                    <ul>
                        ${adviceHtml}
                    </ul>
                </div>
            `;
        }


        function getScoreDescription(score) {
            if (score >= 90) return 'M√ºkemmel üåü';
            if (score >= 80) return '√áok ƒ∞yi üü¢';
            if (score >= 70) return 'ƒ∞yi üü°';
            if (score >= 60) return 'Orta üü†';
            if (score >= 50) return 'Zor üî¥';
            return 'Uygun Deƒüil ‚ùå';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.style.display = 'none';
        }

        function showLoading(isLoading) {
            const loadingDiv = document.getElementById('loading');
            const button = document.querySelector('.btn');
            if (isLoading) {
                loadingDiv.style.display = 'block';
                button.disabled = true; 
            } else {
                loadingDiv.style.display = 'none';
                button.disabled = false;
            }
        }
    </script>
</body>
</html>
